#!/bin/bash
################################################################################
# Enhanced Log Collector - Staging/Testing Configuration
# Author: Yash Shrivastava
# Copyright: Â© 2026 Yash Shrivastava
# License: MIT
# Version: 2.0.0
# Environment: Staging/Testing
################################################################################

# ==============================================================================
# BASE CONFIGURATION
# ==============================================================================

BASE_LOG_DIR="/var/log/staging"
DEFAULT_OWNER="postgres:postgres"
SCRIPT_VERSION="2.0.0"

# ==============================================================================
# LOG ROTATION SETTINGS
# ==============================================================================

# Medium-sized files for staging
MAX_LOG_SIZE_MB=50

# Medium retention for testing
LOG_RETENTION_DAYS=14
ARCHIVE_RETENTION_DAYS=30

# Enable compression to test production behavior
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=6

# ==============================================================================
# OUTPUT FORMAT SETTINGS
# ==============================================================================

DEFAULT_OUTPUT_FORMAT="plain"

# Test JSON format
ENABLE_JSON_FORMAT=true

# Show some console output
ENABLE_CONSOLE_OUTPUT=true

# Test syslog integration
ENABLE_SYSLOG=true
SYSLOG_FACILITY="local1"

# Can test remote syslog here
SYSLOG_SERVER=""

# ==============================================================================
# EMAIL ALERT SETTINGS
# ==============================================================================

# Enable email for testing alerts
ENABLE_EMAIL_ALERTS=true

# QA team email
ALERT_EMAIL="qa-team@company.com,test-alerts@company.com"

# More aggressive alerting for testing
ALERT_LEVELS="ERROR,CRITICAL,FATAL"

EMAIL_SUBJECT_PREFIX="[STAGING-LOG]"
EMAIL_FROM="logcollector@staging.company.com"
SMTP_SERVER=""
SMTP_PORT=25

# ==============================================================================
# PERFORMANCE SETTINGS
# ==============================================================================

# Test async compression
ASYNC_COMPRESSION=true

ENABLE_SIZE_CACHE=true
SIZE_CACHE_TIMEOUT=45
MAX_COMPRESSION_JOBS=3

# ==============================================================================
# RATE LIMITING
# ==============================================================================

# Enable to test rate limiting
ENABLE_RATE_LIMIT=true

# Lower limits for testing
RATE_LIMIT_MAX=5000
RATE_LIMIT_WINDOW=60
RATE_LIMIT_ACTION="sample"

# ==============================================================================
# LOG SAMPLING
# ==============================================================================

# Test sampling functionality
ENABLE_SAMPLING=false
SAMPLE_RATE=100
SAMPLE_EXEMPT_LEVELS="ERROR,CRITICAL,FATAL"

# ==============================================================================
# RETENTION POLICIES BY LOG LEVEL
# ==============================================================================

# Balanced retention for staging
DEBUG_RETENTION_DAYS=7
INFO_RETENTION_DAYS=14
NOTICE_RETENTION_DAYS=14
WARNING_RETENTION_DAYS=30
ERROR_RETENTION_DAYS=60
CRITICAL_RETENTION_DAYS=90
FATAL_RETENTION_DAYS=180

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================

# Production-like permissions
LOG_FILE_PERMISSIONS=640
LOG_DIR_PERMISSIONS=750

VALIDATE_CONFIG_PERMISSIONS=true
SANITIZE_INPUT=true
MAX_TASK_NAME_LENGTH=100
MAX_MESSAGE_LENGTH=65536

# ==============================================================================
# MONITORING & HEALTH
# ==============================================================================

ENABLE_HEALTH_CHECK=true
HEALTH_CHECK_FILE="/var/run/logCollector_staging.health"
HEALTH_CHECK_INTERVAL=60

ENABLE_METRICS=true
METRICS_FILE="/var/log/staging/logCollector_metrics.txt"
METRICS_INTERVAL=180

# ==============================================================================
# STORAGE MANAGEMENT
# ==============================================================================

# Production-like thresholds
MIN_FREE_DISK_MB=512
DISK_WARNING_THRESHOLD=75
DISK_CRITICAL_THRESHOLD=85
DISK_CRITICAL_ACTION="alert"

# ==============================================================================
# ADVANCED FEATURES
# ==============================================================================

# Test advanced features
ENABLE_LOG_STREAMING=true
LOG_STREAM_SOCKET="/var/run/logCollector_staging.sock"

ENABLE_STRUCTURED_LOGGING=true
INCLUDE_STACK_TRACES=true
MAX_STACK_TRACE_DEPTH=15

# ==============================================================================
# INTEGRATION SETTINGS
# ==============================================================================

# Can enable for integration testing
ENABLE_ELASTICSEARCH=false
ELASTICSEARCH_HOST="elasticsearch-staging.company.com"
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_INDEX="logcollector-staging"

ENABLE_SPLUNK=false
SPLUNK_HOST="splunk-staging.company.com"
SPLUNK_PORT=8088
SPLUNK_TOKEN=""

ENABLE_DATADOG=false
DATADOG_API_KEY=""
DATADOG_SITE="datadoghq.com"

# ==============================================================================
# DEBUGGING
# ==============================================================================

# Moderate debugging
DEBUG_MODE=false
DEBUG_LOG_FILE="/var/log/staging/logCollector_debug.log"
LOG_CONFIG_ON_STARTUP=true

# ==============================================================================
# CLEANUP SETTINGS
# ==============================================================================

# Moderate cleanup probability
CLEANUP_CHECK_PROBABILITY=5
CLEANUP_SCHEDULE="0 3 * * *"  # Daily at 3 AM
TEMP_FILE_MAX_AGE=1

# ==============================================================================
# CUSTOM METADATA
# ==============================================================================

CUSTOM_METADATA_ENABLED=true
METADATA_ENVIRONMENT="staging"
METADATA_DATACENTER="us-west-2"
METADATA_CLUSTER="staging-cluster-01"
METADATA_VERSION="$SCRIPT_VERSION"

# ==============================================================================
# TIMEZONE
# ==============================================================================

LOG_TIMEZONE="UTC"
TIMESTAMP_FORMAT="iso8601"
CUSTOM_TIMESTAMP_FORMAT="%Y-%m-%d %H:%M:%S %z"

# ==============================================================================
# TESTING-SPECIFIC SETTINGS
# ==============================================================================

# Enable load testing mode
LOAD_TEST_MODE=false

# Maximum logs per second in load test
LOAD_TEST_MAX_RATE=1000

# Enable chaos testing (random failures)
ENABLE_CHAOS_TESTING=false

# Chaos failure rate (percentage)
CHAOS_FAILURE_RATE=1

# ==============================================================================
# END OF CONFIGURATION
# ==============================================================================
