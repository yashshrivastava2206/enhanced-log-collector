#!/bin/bash
################################################################################
# Enhanced Log Collector - Minimal/Embedded Configuration
# Author: Yash Shrivastava
# Copyright: Â© 2026 Yash Shrivastava
# License: MIT
# Version: 2.0.0
# Environment: Minimal/Embedded/IoT/Edge
# Use Case: Resource-constrained environments (IoT, Edge devices, Raspberry Pi)
################################################################################

# ==============================================================================
# BASE CONFIGURATION
# ==============================================================================

BASE_LOG_DIR="/var/log"
DEFAULT_OWNER="root:root"
SCRIPT_VERSION="2.0.0"

# ==============================================================================
# LOG ROTATION SETTINGS
# ==============================================================================

# Very small files for limited storage
MAX_LOG_SIZE_MB=5

# Minimal retention
LOG_RETENTION_DAYS=1
ARCHIVE_RETENTION_DAYS=2

# Maximum compression to save space
ENABLE_COMPRESSION=true
COMPRESSION_LEVEL=9

# ==============================================================================
# OUTPUT FORMAT SETTINGS
# ==============================================================================

# Plain text only (minimal overhead)
DEFAULT_OUTPUT_FORMAT="plain"
ENABLE_JSON_FORMAT=false

# No console output to save resources
ENABLE_CONSOLE_OUTPUT=false

# No syslog (resource overhead)
ENABLE_SYSLOG=false
SYSLOG_FACILITY="local7"
SYSLOG_SERVER=""

# ==============================================================================
# EMAIL ALERT SETTINGS
# ==============================================================================

# No email (not available on embedded)
ENABLE_EMAIL_ALERTS=false
ALERT_EMAIL=""
ALERT_LEVELS="FATAL"
EMAIL_SUBJECT_PREFIX=""
EMAIL_FROM=""
SMTP_SERVER=""
SMTP_PORT=25

# ==============================================================================
# PERFORMANCE SETTINGS
# ==============================================================================

# Synchronous to avoid extra processes
ASYNC_COMPRESSION=false

# No caching to save memory
ENABLE_SIZE_CACHE=false
SIZE_CACHE_TIMEOUT=0

# Minimal workers
MAX_COMPRESSION_JOBS=1

# ==============================================================================
# RATE LIMITING
# ==============================================================================

# Essential to prevent resource exhaustion
ENABLE_RATE_LIMIT=true

# Very low limits
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=60

# Drop to save resources
RATE_LIMIT_ACTION="drop"

# ==============================================================================
# LOG SAMPLING
# ==============================================================================

# Aggressive sampling
ENABLE_SAMPLING=true

# Log only 1% of non-critical messages
SAMPLE_RATE=1

SAMPLE_EXEMPT_LEVELS="ERROR,CRITICAL,FATAL"

# ==============================================================================
# RETENTION POLICIES BY LOG LEVEL
# ==============================================================================

# Extremely short retention
DEBUG_RETENTION_DAYS=0  # Don't keep DEBUG
INFO_RETENTION_DAYS=0   # Don't keep INFO
NOTICE_RETENTION_DAYS=1
WARNING_RETENTION_DAYS=1
ERROR_RETENTION_DAYS=2
CRITICAL_RETENTION_DAYS=3
FATAL_RETENTION_DAYS=7

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================

LOG_FILE_PERMISSIONS=640
LOG_DIR_PERMISSIONS=750
VALIDATE_CONFIG_PERMISSIONS=false  # Skip to save cycles

SANITIZE_INPUT=true

# Very restrictive limits
MAX_TASK_NAME_LENGTH=50
MAX_MESSAGE_LENGTH=512  # Very short messages only

# ==============================================================================
# MONITORING & HEALTH
# ==============================================================================

# Minimal health checking
ENABLE_HEALTH_CHECK=false
HEALTH_CHECK_FILE=""
HEALTH_CHECK_INTERVAL=0

# No metrics to save resources
ENABLE_METRICS=false
METRICS_FILE=""
METRICS_INTERVAL=0

# ==============================================================================
# STORAGE MANAGEMENT
# ==============================================================================

# Very low threshold for limited storage
MIN_FREE_DISK_MB=10
DISK_WARNING_THRESHOLD=60
DISK_CRITICAL_THRESHOLD=75

# Immediate cleanup
DISK_CRITICAL_ACTION="cleanup"

# ==============================================================================
# ADVANCED FEATURES
# ==============================================================================

# All disabled to save resources
ENABLE_LOG_STREAMING=false
LOG_STREAM_SOCKET=""

ENABLE_STRUCTURED_LOGGING=false

INCLUDE_STACK_TRACES=false
MAX_STACK_TRACE_DEPTH=0

# ==============================================================================
# INTEGRATION SETTINGS
# ==============================================================================

# All disabled
ENABLE_ELASTICSEARCH=false
ELASTICSEARCH_HOST=""
ELASTICSEARCH_PORT=0
ELASTICSEARCH_INDEX=""

ENABLE_SPLUNK=false
SPLUNK_HOST=""
SPLUNK_PORT=0
SPLUNK_TOKEN=""

ENABLE_DATADOG=false
DATADOG_API_KEY=""
DATADOG_SITE=""

# ==============================================================================
# DEBUGGING
# ==============================================================================

# No debugging
DEBUG_MODE=false
DEBUG_LOG_FILE="/dev/null"
LOG_CONFIG_ON_STARTUP=false

# ==============================================================================
# CLEANUP SETTINGS
# ==============================================================================

# Very aggressive cleanup
CLEANUP_CHECK_PROBABILITY=100  # Always cleanup
CLEANUP_SCHEDULE=""
TEMP_FILE_MAX_AGE=0

# ==============================================================================
# CUSTOM METADATA
# ==============================================================================

# Minimal metadata
CUSTOM_METADATA_ENABLED=false
METADATA_ENVIRONMENT="embedded"
METADATA_VERSION="$SCRIPT_VERSION"

# ==============================================================================
# TIMEZONE
# ==============================================================================

LOG_TIMEZONE=""  # Use system default
TIMESTAMP_FORMAT="unix"  # Smallest format
CUSTOM_TIMESTAMP_FORMAT=""

# ==============================================================================
# EMBEDDED-SPECIFIC SETTINGS
# ==============================================================================

# Disable all optional features
DISABLE_OPTIONAL_FEATURES=true

# Use minimal memory
USE_MINIMAL_MEMORY=true

# Maximum memory usage (KB)
MAX_MEMORY_KB=1024

# Disable buffering
DISABLE_BUFFERING=true

# Use simple rotation (no date-based)
SIMPLE_ROTATION_ONLY=true

# No background processes
NO_BACKGROUND_PROCESSES=true

# Minimal logging levels only
ALLOWED_LOG_LEVELS="ERROR,CRITICAL,FATAL"

# ==============================================================================
# RESOURCE LIMITS
# ==============================================================================

# CPU throttling (nice level)
CPU_NICE_LEVEL=19

# I/O throttling (ionice class)
IO_NICE_CLASS=3  # Idle

# Maximum file descriptors
MAX_FILE_DESCRIPTORS=10

# Disable all caching
DISABLE_ALL_CACHING=true

# ==============================================================================
# EMERGENCY SETTINGS
# ==============================================================================

# When disk space critically low
EMERGENCY_CLEANUP_ENABLED=true

# Delete all logs except FATAL when emergency
EMERGENCY_DELETE_ALL_EXCEPT_FATAL=true

# Minimum free disk to operate (KB)
EMERGENCY_MIN_DISK_KB=100

# ==============================================================================
# END OF CONFIGURATION
# ==============================================================================
